<html>
    <head>
        <title>
            Cards Against Humanity
        </title>
        <style>
            #left{
                width: 80%;
                height:100%;
                display:inline-block;
            }
            #right{
                width:19.5%;
                height:100%;
                float: right;
                border-left:1px solid white;
                background-color: black;
            }
            #messagetext{
                width: 100%;
                height: 4%;
            }
            #chat{
                width:100%;
                height:96%;
            }
            body{
                background-color: black;
                color:white;
            }
            #dashboard{
                width: 100%;
                height:40%;
                background-color: white;
                color:black;
            }
            #streams{
                width:100%;
                height: 60%;
            }
            .card{
                height:49.8%;
                width:24.8%;
                border: 1px solid black;
                float: left;
            }
            #card0{
                background-color: black;
            }
            #menu{
                width:100%;
                height: 9%;
            }
            .submit{
                float:right;
                background-color: white;
                border:0px;
                font-size: medium;
                margin:1%;
            }
            .menubutton{
                height: 100%;
                border: 0px;
                background-color: white;
                width:10%;
            }
            #cards{
                height:90%;
                width:100%;
            }
            #game{
                display:none;
            }
            #startup{
                width:25%;
                height:20%;
                margin-left: auto;
                margin-top: 15%;
                margin-bottom: auto;
                margin-right: auto;
                background-color:black;
                color:white;
                
            }
            .gamebutton{
                width: 100px;
                margin: 20px;
                background-color: black;
                color: white;
                border: 1px solid white;
                padding: 15px;
            }
            #firstheader{
                margin: 20px;
                padding-top: 20px;
            }
            #joingamemenu{
                color: white;
                display: none;
            }
            #newgamemenu{
                display: none;
                border: 1px solid white;
            }
            .startfields{
                margin: 2%;
            }
        </style>
        <script>
            var isopen = false;
            const socket = new WebSocket('ws://localhost:3012');
            var username = "";
            var gamecode = "0";
            
            //var message = "";
            //var last_message = "";
            function changeimage(){
                let images = ["cah1.jpeg", "cah2.jpeg", "cah3.png"];
                let i = Math.round(Math.random() * 1000) % 3;
                document.body.style.backgroundImage = "url(images/" + images[i] + ")";
            }
            socket.addEventListener('open', function (event) {
                isopen = true;
                //message = event.data;
                changeimage();
            });
            socket.addEventListener('message', function (event) {
                console.log('Message from server', event.data);
                let content = JSON.parse(event.data);
                if(content.task == "StartGame"){
                    gamecode = content.data;
                    console.log("gameid: " + gamecode);
                    let drawcard = {
                        gameid: gamecode,
                        username: username,
                        kind: "Game",
                        task: "DrawWhite",
                        data: "",
                    }
                    let CreateUser = {
                        gameid: gamecode,
                        username: username,
                        kind: "Admin",
                        task: "CreateUser",
                        data: username,
                    }
                    socket.send(JSON.stringify(CreateUser));
                    let count = 0;
                    while(count < 7){
                        socket.send(JSON.stringify(drawcard));
                        
                        count = count + 1;             
                    }
                }
                if(content.task == "DrawWhite"){
                    let card1 = document.getElementById("content1");
                    let card2 = document.getElementById("content2");
                    let card3 = document.getElementById("content3");
                    let card4 = document.getElementById("content4");
                    let card5 = document.getElementById("content5");
                    let card6 = document.getElementById("content6");
                    let card7 = document.getElementById("content7");
                    let cards = [card1, card2, card3, card4, card5, card6, card7];
                    let foundcard = false;
                    cards.forEach(card => {
                        if(card.innerHTML == "" && !foundcard){
                            card.innerHTML = content.data;
                            foundcard = true;
                        }
                    });
                } 
            });
            //only use this as a way of recv data when absolutely nessisary the event listener
            //shoud be used whenever possible
            /*function recv(){
                while(last_message == message){
                    setTimeout(function (){}, 1000);
                } 
            }*/
            function show_score(){
                document.getElementById("cards").style.display = "none";

            }
            function show_board(){
                document.getElementById("cards").style.display = "block";
            }
            function submit(param){
                switch(param){
                    case 1: { document.getElementById("content1").innerHTML = ""; break;}
                    case 2: { document.getElementById("content2").innerHTML = ""; break; }
                    case 3: { document.getElementById("content3").innerHTML = ""; break; }
                    case 4: { document.getElementById("content4").innerHTML = ""; break; }
                    case 5: { document.getElementById("content5").innerHTML = ""; break; }
                    case 6: { document.getElementById("content6").innerHTML = ""; break; }
                    case 7: { document.getElementById("content7").innerHTML = ""; break; }
                }
                let drawcard = {
                    gameid: gamecode,
                    username: username,
                    kind: "Game",
                    task: "DrawWhite",
                    data: "",
                }
                if(isopen){
                    socket.send(JSON.stringify(drawcard));
                }
            }
            
            function newgame(){             
                document.getElementById("firstscreen").style.display = "none";
                document.getElementById("newgamemenu").style.display = "block";
                
            }
            function startgame(){
                username = document.getElementById("useridnew").value;
                
                let startgame = {
                    gameid: gamecode,
                    username: "",
                    kind: "Admin",
                    task: "StartGame",
                    data: "",
                }

                if(isopen){
                    socket.send(JSON.stringify(startgame));
                    document.getElementById("startup").style.display = "none";
                    document.getElementById("game").style.display = "block";
                    
                }else{
                    window.alert("unable to connect to server");
                }
            }
            function joingame(){
                document.getElementById("firstscreen").style.display = "none";
                document.getElementById("joingamemenu").style.display = "block";
            }
            function join(){
                if(isopen){
                    document.getElementById("startup").style.display = "none";
                    document.getElementById("game").style.display = "block";
                    username = document.getElementById("userid").value;
                    gamecode = document.getElementById("gameid").value;
                    let CreateUser = {
                        gameid: gamecode,
                        username: username,
                        kind: "Admin",
                        task: "CreateUser",
                        data: username,
                    }
                    socket.send(JSON.stringify(CreateUser));
                }else{
                    window.alert("web socket didn't open");
                }
            }
        </script>
    </head>
    <body>
        <div id="startup">
            <center>
            <div id="firstscreen">
                <h4 id="firstheader">Choose what to do</h4>
                <table>
                    <tr>
                        <th>
                        <input type="button" id="newgame" onclick="newgame()" value="new game" class="gamebutton"/>
                        </th>
                        <th>
                        <input type="button" id="joingame" onclick="joingame()" value="join game" class="gamebutton"/>
                        </th>
                    </tr>   
                </table>
            </div>
            <div id="newgamemenu">
                <input type="text" id="useridnew" placeholder="enter prefered username" class="startfields"/>
                <br/>
                <br/>
                <input type="button" id="submitnewgame" onclick="startgame()" value="Start Game"/>
            </div>
            <div id="joingamemenu">
                <h4>Join Game</h4>
                <input type="text" id="gameid" placeholder="enter game id" class="startfields"/>
                <input type="text" id="userid" placeholder="enter prefered username" class="startfields"/>
                <br/>
                <br/>
                <input type="button" id="submitjoingame" onclick="join()" value="Join Game"/>
            </div>
        </center>
          </div>
        <div id="game">
            <div id="left">
                <div id="streams"></div>
                <div id="dashboard">
                    <div id="menu">
                        <input type="button" value="skip" onclick="submit(0)" class="menubutton"/>
                        <input type="button" value="cards" onclick="show_board()" class="menubutton"/>
                        <input type="button" value="score board" onclick="show_score()" class="menubutton"/>
                        
                    </div>
                    <div id="cards">
                        <div id="card0" clas="black_card" class="card">
                            
                        </div>
                        <div id="card1" clas="white_card" class="card">
                            <div id="content1" class="content"></div>
                            <input type="button" value="submit" class="submit" onclick="submit(1)"/>
                        </div>
                        <div id="card2" clas="white_card" class="card">
                            <div id="content2" class="content"></div>
                            <input type="button" value="submit" class="submit" onclick="submit(2)"/>
                        </div>
                        <div id="card3" clas="white_card" class="card">
                            <div id="content3" class="content"></div>
                            <input type="button" value="submit" class="submit" onclick="submit(3)"/>
                        </div>
                        <div id="card4" clas="white_card" class="card">
                            <div id="content4" class="content"></div>
                            <input type="button" value="submit" class="submit" onclick="submit(4)"/>
                        </div>
                        <div id="card5" clas="white_card" class="card">
                            <div id="content5" class="content"></div>
                            <input type="button" value="submit" class="submit" onclick="submit(5)"/>
                        </div>
                        <div id="card6" clas="white_card" class="card">
                            <div id="content6" class="content"></div>
                            <input type="button" value="submit" class="submit" onclick="submit(6)"/>
                        </div>
                        <div id="card7" clas="white_card" class="card">
                            <div id="content7" class="content"></div>
                            <input type="button" value="submit" class="submit" onclick="submit(7)"/>
                        </div>
                    </div>
                </div>
            </div>
            <div id="right">
                <div id="chat"></div>
                <input type="text" placeholder="Enter text to chat." id="messagetext"/>
            </div>
        </div>
    </body>
</html>